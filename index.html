<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>MaltoStore - Top Up Robux</title>
<script src="https://cdn.tailwindcss.com"></script>
<script src="https://cdn.jsdelivr.net/npm/qrcodejs@1.0.0/qrcode.min.js"></script>
<style>
:root {
  --accent: #FFE900;
}
body {
  font-family: "Inter", sans-serif;
  background: #f4f7fb;
  color: #1f2937;
}
body.dark { background: #0a0f2b; color: #d6d2ff; }
.card {
  background: #fff;
  border: 1px solid #ddd;
  box-shadow: 0 0 10px rgba(0,0,0,0.1);
}
body.dark .card { background: #11153b; border-color: #3b2d77; }
#themeToggle {
  position: fixed;
  top: 16px; right: 16px;
  width: 50px; height: 50px;
  background: #fff;
  border-radius: 9999px;
  border: 2px solid var(--accent);
  font-size: 24px;
  cursor: pointer;
}
body.dark #themeToggle { background: #11153b; color: #8b5cf6; border-color: #8b5cf6; }
</style>
</head>

<body>
<button id="themeToggle">üåô</button>

<div id="formPage" class="flex flex-col items-center justify-center min-h-screen p-6">
  <div class="card rounded-2xl p-6 w-full max-w-md">
    <h1 class="text-3xl font-bold text-center mb-4">üéÆ MaltoStore Robux Top Up</h1>

    <label class="block mb-2 font-medium">Masukkan Username Roblox</label>
    <div class="flex gap-2 mb-3">
      <input id="playerId" type="text" class="flex-1 p-3 rounded-lg border" placeholder="Contoh: BloxPlayer123">
      <button id="checkUserBtn" class="bg-yellow-400 text-white px-4 rounded-lg">üîç</button>
    </div>
    <p id="checkStatus" class="text-sm mb-4 text-gray-600 italic">Belum diperiksa</p>

    <div id="avatarContainer" class="hidden flex flex-col items-center mb-4">
      <img id="avatarPreview" class="w-32 h-32 rounded-lg border mb-2" alt="Avatar Roblox">
      <p id="robloxName" class="font-semibold"></p>
    </div>

    <label class="block mb-2 font-medium">Jumlah Robux</label>
    <input id="robuxInput" type="number" min="50" class="w-full p-3 rounded-lg mb-2">
    <p id="robuxEstimate" class="text-sm opacity-70 mb-4">Minimal 50 Robux</p>

    <button id="qrisBtn" class="bg-yellow-400 hover:bg-yellow-500 text-white w-full py-3 rounded-lg font-semibold">‚ö° Generate QRIS</button>
  </div>
</div>

<div id="resultPage" class="hidden min-h-screen flex flex-col">
  <div class="p-4 bg-yellow-400 text-white flex items-center">
    <button id="backBtn" class="mr-3 text-lg">‚Üê</button>
    <h2 class="font-semibold">Kembali</h2>
  </div>
  <div class="flex flex-col items-center justify-center flex-1 p-6">
    <div class="card p-6 rounded-xl text-center max-w-md w-full">
      <h2 class="text-2xl font-bold mb-3">QRIS Pembayaran</h2>
      <div id="qrisContainer" class="bg-white p-4 rounded-lg inline-block mx-auto mb-4"></div>
      <p id="amountQR" class="text-lg font-semibold mb-4"></p>
      <button id="downloadBtn" class="bg-yellow-400 text-white px-6 py-2 rounded-lg">üíæ Simpan QRIS</button>
    </div>
  </div>
</div>

<script>
// === DARK MODE ===
const body = document.body, themeBtn = document.getElementById("themeToggle");
function applyTheme(d){body.classList.toggle("dark",d);themeBtn.textContent=d?"‚òÄÔ∏è":"üåô";localStorage.theme=d?"dark":"light";}
applyTheme(localStorage.theme==="dark");
themeBtn.onclick=()=>applyTheme(!body.classList.contains("dark"));

// === CEK USERNAME ROBLOX ===
const checkBtn = document.getElementById("checkUserBtn");
const usernameInput = document.getElementById("playerId");
const checkStatus = document.getElementById("checkStatus");
const avatarContainer = document.getElementById("avatarContainer");
const avatarPreview = document.getElementById("avatarPreview");
const robloxName = document.getElementById("robloxName");

checkBtn.onclick = async () => {
  const username = usernameInput.value.trim();
  if (!username) return alert("Masukkan username Roblox!");
  checkStatus.textContent = "üîÑ Memeriksa username...";
  avatarContainer.classList.add("hidden");

  try {
    const res = await fetch(`https://users.roblox.com/v1/usernames/users`, {
      method: "POST",
      headers: {"Content-Type": "application/json"},
      body: JSON.stringify({usernames: [username]})
    });
    const data = await res.json();
    if (data.data && data.data.length > 0 && data.data[0].id) {
      const user = data.data[0];
      checkStatus.textContent = "‚úÖ Username valid!";
      robloxName.textContent = user.name;
      const avatarRes = await fetch(`https://thumbnails.roblox.com/v1/users/avatar-headshot?userIds=${user.id}&size=150x150&format=Png`);
      const avatarData = await avatarRes.json();
      avatarPreview.src = avatarData.data[0].imageUrl;
      avatarContainer.classList.remove("hidden");
    } else {
      checkStatus.textContent = "‚ùå Username tidak ditemukan!";
    }
  } catch (err) {
    checkStatus.textContent = "‚ö†Ô∏è Gagal memeriksa (cek koneksi internet).";
  }
};

// === GENERATE QRIS ===
document.getElementById("qrisBtn").onclick = () => {
  const username = usernameInput.value.trim();
  const robux = parseInt(document.getElementById("robuxInput").value);
  if (!username) return alert("Masukkan username Roblox!");
  if (isNaN(robux) || robux < 50) return alert("Minimal pembelian adalah 50 Robux!");

  const total = robux * 150 + 200; // + admin fee 200
  const qrContainer = document.getElementById("qrisContainer");
  qrContainer.innerHTML = "";
  new QRCode(qrContainer, { text: `RobloxTopUp:${username}:${robux}:${total}`, width: 240, height: 240 });

  document.getElementById("amountQR").textContent = "Total: Rp" + total.toLocaleString();
  document.getElementById("formPage").classList.add("hidden");
  document.getElementById("resultPage").classList.remove("hidden");

  document.getElementById("downloadBtn").onclick = () => {
    const canvas = qrContainer.querySelector("canvas");
    const link = document.createElement("a");
    link.download = `QRIS_Roblox_${username}.png`;
    link.href = canvas.toDataURL();
    link.click();
  };
};

document.getElementById("backBtn").onclick = () => {
  document.getElementById("resultPage").classList.add("hidden");
  document.getElementById("formPage").classList.remove("hidden");
};
</script>
</body>
</html>
