<!doctype html>

<html lang="id">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Cek Username Roblox & Avatar</title>
  <style>
    :root{font-family: Inter, system-ui, -apple-system, 'Segoe UI', Roboto, 'Helvetica Neue', Arial;}
    body{display:flex;align-items:center;justify-content:center;min-height:100vh;margin:0;background:#0f172a;color:#e6eef8}
    .card{width:100%;max-width:720px;background:linear-gradient(180deg,#0b1220 0%, #071027 100%);padding:28px;border-radius:12px;box-shadow:0 8px 30px rgba(2,6,23,0.6);}
    h1{margin:0 0 10px;font-size:20px}
    p.lead{margin:0 0 20px;color:#a8c0df}
    .row{display:flex;gap:12px}
    input[type=text]{flex:1;padding:10px 12px;border-radius:8px;border:1px solid rgba(255,255,255,0.06);background:rgba(255,255,255,0.02);color:inherit;font-size:15px}
    button{padding:10px 14px;border-radius:8px;border:none;background:#1e90ff;color:white;font-weight:600;cursor:pointer}
    button:disabled{opacity:0.6;cursor:not-allowed}
    .result{margin-top:18px;display:flex;gap:16px;align-items:center}
    .avatar{width:160px;height:160px;border-radius:10px;background:linear-gradient(180deg,#0b1220,#051027);display:flex;align-items:center;justify-content:center;overflow:hidden}
    .meta{flex:1}
    .meta p{margin:4px 0}
    .error{margin-top:12px;padding:10px;border-radius:8px;background:#3b1b1b;color:#ffdede}
    .small{font-size:13px;color:#9fb2d6}
    .hint{margin-top:8px;color:#8fa9d2;font-size:13px}
    a.link{color:#9fe0ff;text-decoration:none}
  </style>
</head>
<body>
  <div class="card">
    <h1>Cek Username Roblox & Tampilkan Avatar</h1>
    <p class="lead">Masukkan username Roblox untuk melihat informasi akun dan avatar (headshot).</p><div class="row">
  <input id="username" type="text" placeholder="Masukkan username Roblox, mis. Builderman" autocapitalize="none" />
  <button id="checkBtn">Cek</button>
</div>

<div id="status" class="hint">Contoh: masukkan username lalu klik <strong>Cek</strong>. Jika gagal, periksa koneksi internet atau username tidak ditemukan.</div>

<div id="error" class="error" style="display:none"></div>

<div id="output" style="display:none" class="result">
  <div class="avatar" id="avatarWrap">
    <span class="small">Avatar</span>
  </div>
  <div class="meta">
    <p><strong id="displayName">-</strong> <span id="robloxId" class="small">(ID: -)</span></p>
    <p class="small" id="created">-</p>
    <p class="small">Profile: <a id="profileLink" class="link" href="#" target="_blank" rel="noopener">Buka di Roblox</a></p>
    <div style="margin-top:8px">
      <button id="downloadBtn">Download Avatar</button>
    </div>
  </div>
</div>

  </div>  <script>
    const checkBtn = document.getElementById('checkBtn');
    const usernameInput = document.getElementById('username');
    const statusEl = document.getElementById('status');
    const errorEl = document.getElementById('error');
    const output = document.getElementById('output');
    const displayName = document.getElementById('displayName');
    const robloxId = document.getElementById('robloxId');
    const createdEl = document.getElementById('created');
    const profileLink = document.getElementById('profileLink');
    const avatarWrap = document.getElementById('avatarWrap');
    const downloadBtn = document.getElementById('downloadBtn');

    function showError(msg){
      errorEl.style.display='block';
      errorEl.textContent = ' ' + msg;
      output.style.display='none';
    }
    function clearError(){ errorEl.style.display='none'; errorEl.textContent=''; }

    async function fetchJson(url, opts){
      const res = await fetch(url, opts);
      if(!res.ok) throw new Error('HTTP ' + res.status);
      return res.json();
    }

    async function getUserByUsername(username){
      const url = `https://users.roblox.com/v1/users/by-username/${encodeURIComponent(username)}`;
      return fetchJson(url);
    }

    async function getAvatarHeadshot(userId, size=420){
      // thumbnails.roblox.com untuk headshot/avatar
      const url = `https://thumbnails.roblox.com/v1/users/avatar-headshot?userIds=${userId}&size=${size}x${size}&format=Png&isCircular=false`;
      const j = await fetchJson(url);
      if(j && j.data && j.data[0] && j.data[0].imageUrl) return j.data[0].imageUrl;
      throw new Error('Tidak dapat mengambil avatar');
    }

async function handleCheck(){
  const username = usernameInput.value.trim();
  clearError();
  if(!username){ showError('Masukkan username Roblox.'); return; }

  checkBtn.disabled = true; statusEl.textContent = 'Mengecek...';

  try{
    const res = await fetch(`/api/cek?username=${encodeURIComponent(username)}`);
    if(!res.ok) throw new Error('Gagal fetch');
    const data = await res.json();

    output.style.display = 'flex';
    displayName.textContent = data.displayName;
    robloxId.textContent = `(ID: ${data.id})`;
    createdEl.textContent = 'Bergabung: ' + (new Date(data.created).toLocaleString());
    profileLink.href = data.profileUrl;
    profileLink.textContent = data.profileUrl;

    avatarWrap.innerHTML = '';
    const img = document.createElement('img');
    img.src = data.avatarUrl;
    img.alt = 'Avatar Roblox';
    img.style.maxWidth = '100%';
    img.style.display = 'block';
    avatarWrap.appendChild(img);

    downloadBtn.onclick = () => {
      const a = document.createElement('a');
      a.href = data.avatarUrl;
      a.download = `${data.name}_avatar.png`;
      document.body.appendChild(a);
      a.click();
      a.remove();
    };

    statusEl.textContent = 'Sukses — hasil ditampilkan di bawah.';
  }catch(err){
    console.error(err);
    showError('Gagal memeriksa username.');
  } finally{
    checkBtn.disabled = false;
  }
}

    checkBtn.addEventListener('click', handleCheck);
    usernameInput.addEventListener('keydown', (e)=>{ if(e.key==='Enter') handleCheck(); });
  </script></body>
</html>