<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>MaltoStore - Top Up Robux</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdn.jsdelivr.net/npm/qrcodejs@1.0.0/qrcode.min.js"></script>
  <style>
    :root {
      --light-bg: #f4f7fb;
      --light-card: #ffffff;
      --light-text: #1f2937;
      --light-border: #d1d5db;
      --light-accent: #FFE900;
      --header-bg: #F1C31C;

      --dark-bg: #0a0f2b;
      --dark-card: #11153b;
      --dark-text: #d6d2ff;
      --dark-border: #3b2d77;
      --dark-accent: #8b5cf6;
    }

    body {
      background-color: var(--light-bg);
      color: var(--light-text);
      font-family: "Inter", sans-serif;
      transition: background-color 0.5s, color 0.5s;
    }

    body.dark {
      background-color: var(--dark-bg);
      color: var(--dark-text);
    }

    .card {
      background-color: var(--light-card);
      border: 1px solid var(--light-border);
      box-shadow: 0 0 15px rgba(0, 0, 0, 0.08);
      transition: background-color 0.5s, border-color 0.5s, color 0.5s;
    }

    body.dark .card {
      background-color: var(--dark-card);
      border-color: var(--dark-border);
    }

    input {
      background-color: var(--light-bg);
      color: var(--light-text);
      border: 1px solid var(--light-border);
      transition: all 0.4s ease;
    }

    body.dark input {
      background-color: #1a1f45;
      color: var(--dark-text);
      border-color: var(--dark-border);
    }

    .btn-primary {
      background-color: var(--light-accent);
      color: white;
      transition: 0.3s;
    }

    .btn-primary:hover {
      background-color: #2563eb;
    }

    body.dark .btn-primary {
      background-color: var(--dark-accent);
      color: white;
    }

    body.dark .btn-primary:hover {
      background-color: #7c3aed;
    }

    #themeToggle {
      position: fixed;
      top: 16px;
      right: 16px;
      background-color: var(--light-card);
      border: 2px solid var(--light-accent);
      border-radius: 9999px;
      width: 50px;
      height: 50px;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      font-size: 26px;
      transition: all 0.4s ease;
      z-index: 50;
      color: var(--light-accent);
    }

    body.dark #themeToggle {
      background-color: var(--dark-card);
      border-color: var(--dark-accent);
      color: var(--dark-accent);
    }

    #themeToggle:hover {
      transform: rotate(15deg) scale(1.1);
    }

    .header-bar {
      background-color: var(--header-bg);
      transition: background-color 0.5s ease, color 0.5s ease;
    }

    body.dark .header-bar {
      background-color: #6d28d9;
      color: #fff;
    }

    #avatarPreview {
      width: 120px;
      height: 120px;
      border-radius: 50%;
      border: 3px solid var(--light-accent);
    }

    body.dark #avatarPreview {
      border-color: var(--dark-accent);
    }
  </style>
</head>

<body>
  <button id="themeToggle">üåô</button>

  <div id="formPage" class="flex flex-col items-center justify-center min-h-screen p-6">
    <div class="card rounded-2xl p-6 w-full max-w-md">
      <h1 class="text-3xl font-bold mb-4 text-center">üéÆ MaltoStore Top Up Robux</h1>

      <label class="block mb-2 font-medium">Masukkan Username Roblox</label>
      <div class="flex mb-3">
        <input id="usernameInput" type="text" class="flex-1 p-3 rounded-l-lg border border-gray-300"
               placeholder="Contoh: PlayerRoblox123">
        <button id="checkBtn" class="btn-primary px-4 rounded-r-lg">üîç Cek</button>
      </div>
      <p id="userStatus" class="text-sm mb-4 text-gray-500 italic">Belum dicek</p>

      <div id="avatarSection" class="flex flex-col items-center mb-4 hidden">
        <img id="avatarPreview" src="" alt="Avatar Roblox">
        <p id="displayName" class="mt-2 font-semibold"></p>
      </div>

      <label class="block mb-2 font-medium">Jumlah Robux</label>
      <input id="robuxInput" type="number" min="50" class="w-full p-3 rounded-lg mb-2" placeholder="Minimal 50 Robux">
      <p id="robuxEstimate" class="text-sm mb-2 opacity-70">Estimasi: Rp0</p>
      <p id="gamepassInfo" class="text-sm mb-4 text-blue-500 font-semibold hidden"></p>

      <button id="generateBtn" class="btn-primary w-full py-3 rounded-lg font-semibold">‚ö° Generate QRIS</button>
    </div>
  </div>

  <div id="resultPage" class="hidden min-h-screen flex flex-col">
    <div class="flex items-center px-4 py-3 text-slate-900 dark:text-white header-bar">
      <button id="backBtn" class="text-lg mr-2">‚Üê</button>
      <h2 class="text-lg font-semibold">Kembali</h2>
    </div>

    <div class="flex-1 overflow-auto p-6">
      <div class="max-w-md mx-auto">
        <div class="card rounded-xl p-5 mb-4">
          <p class="text-sm opacity-80">Total Bayar</p>
          <h1 id="totalAmount" class="text-3xl font-bold">Rp0</h1>
        </div>

        <div class="card rounded-xl p-5 mb-6">
          <h3 class="font-semibold mb-3">Detail Top Up</h3>
          <p class="flex justify-between mb-1"><span>Username</span><span id="rUsername"></span></p>
          <p class="flex justify-between mb-1"><span>User ID</span><span id="rUserId"></span></p>
          <p class="flex justify-between mb-1"><span>Jumlah Robux</span><span id="rRobux"></span></p>
          <p class="flex justify-between mb-1"><span>Gamepass Harga</span><span id="rGamepass"></span></p>
          <p class="flex justify-between mb-1"><span>Biaya Admin</span><span id="rAdmin"></span></p>
        </div>

        <div class="flex flex-col items-center text-center">
          <div id="qrcodeContainer" class="bg-white p-4 rounded-lg shadow-sm mb-3">
            <div id="qrcode"></div>
          </div>
          <p id="amountQR" class="text-lg font-semibold mb-4"></p>

          <button id="downloadQR" class="btn-primary w-full py-3 rounded-lg mb-2">üíæ Download QRIS</button>
          <button id="waBtn" class="w-full bg-green-600 hover:bg-green-500 text-white py-3 rounded-lg font-semibold">üí¨ Kirim Bukti via WhatsApp</button>
        </div>
      </div>
    </div>
  </div>

  <script>
    // THEME TOGGLE
    const bodyEl = document.body;
    const themeToggle = document.getElementById("themeToggle");
    function setTheme(isDark) {
      bodyEl.classList.toggle("dark", isDark);
      themeToggle.textContent = isDark ? "‚òÄÔ∏è" : "üåô";
      localStorage.theme = isDark ? "dark" : "light";
    }
    setTheme(localStorage.theme === "dark");
    themeToggle.onclick = () => setTheme(!bodyEl.classList.contains("dark"));

    // VARIABLES
    const checkBtnEl = document.getElementById("checkBtn");
    const usernameInputEl = document.getElementById("usernameInput");
    const userStatusEl = document.getElementById("userStatus");
    const avatarSectionEl = document.getElementById("avatarSection");
    const avatarPreviewEl = document.getElementById("avatarPreview");
    const displayNameEl = document.getElementById("displayName");
    let validUser = false;
    let userId = null;
    let userName = null;

    const robuxInputEl = document.getElementById("robuxInput");
    const robuxEstimateEl = document.getElementById("robuxEstimate");
    const gamepassInfoEl = document.getElementById("gamepassInfo");

    const generateBtnEl = document.getElementById("generateBtn");
    const formPageEl = document.getElementById("formPage");
    const resultPageEl = document.getElementById("resultPage");
    const backBtnEl = document.getElementById("backBtn");

    const totalAmountEl = document.getElementById("totalAmount");
    const rUsernameEl = document.getElementById("rUsername");
    const rUserIdEl = document.getElementById("rUserId");
    const rRobuxEl = document.getElementById("rRobux");
    const rGamepassEl = document.getElementById("rGamepass");
    const rAdminEl = document.getElementById("rAdmin");
    const qrcodeContainerEl = document.getElementById("qrcode");
    const amountQREl = document.getElementById("amountQR");
    const downloadQREl = document.getElementById("downloadQR");
    const waBtnEl = document.getElementById("waBtn");

    const PRICE_PER_ROBUX = 150;
    const MIN_ROBUX = 50;

    function estimateRobux(val) {
      const totalRp = val * PRICE_PER_ROBUX;
      return totalRp;
    }

    function calculateGamepass(val) {
      return Math.ceil(val / 0.7);
    }

    robuxInputEl.addEventListener("input", () => {
      const val = parseInt(robuxInputEl.value) || 0;
      if (val >= MIN_ROBUX) {
        robuxEstimateEl.textContent = `Estimasi: Rp${estimateRobux(val).toLocaleString()}`;
        const gp = calculateGamepass(val);
        gamepassInfoEl.textContent = `üéØ Buat Gamepass senilai ${gp} Robux agar ${val} Robux masuk penuh`;
        gamepassInfoEl.classList.remove("hidden");
      } else if (val > 0) {
        robuxEstimateEl.textContent = `‚ùå Minimal pembelian adalah ${MIN_ROBUX} Robux`;
        gamepassInfoEl.classList.add("hidden");
      } else {
        robuxEstimateEl.textContent = `Estimasi: Rp0`;
        gamepassInfoEl.classList.add("hidden");
      }
    });

    checkBtnEl.onclick = async () => {
      const username = usernameInputEl.value.trim();
      if (!username) {
        alert("Masukkan username Roblox!");
        return;
      }
      userStatusEl.textContent = "üîé Memeriksa username...";
      avatarSectionEl.classList.add("hidden");
      validUser = false;

      try {
        const resp = await fetch("https://users.roblox.com/v1/usernames/users", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ usernames: [username] })
        });
        const d = await resp.json();
        if (d.data && d.data.length > 0 && d.data[0].id) {
          validUser = true;
          userId = d.data[0].id;
          userName = d.data[0].name;
          displayNameEl.textContent = userName;
          avatarPreviewEl.src = `https://www.roblox.com/headshot-thumbnail/image?userId=${userId}&width=150&height=150&format=png`;
          avatarSectionEl.classList.remove("hidden");
          userStatusEl.textContent = `‚úÖ Username valid: ${userName} (ID: ${userId})`;
        } else {
          userStatusEl.textContent = "‚ùå Username tidak ditemukan!";
        }
      } catch (err) {
        userStatusEl.textContent = "‚ö†Ô∏è Gagal memeriksa (cek koneksi internet).";
      }
    };

    generateBtnEl.onclick = () => {
      const username = usernameInputEl.value.trim();
      const robuxVal = parseInt(robuxInputEl.value);
      if (!validUser) {
        alert("Harap cek username Roblox terlebih dahulu!");
        return;
      }
      if (isNaN(robuxVal) || robuxVal < MIN_ROBUX) {
        alert(`Minimal pembelian adalah ${MIN_ROBUX} Robux!`);
        return;
      }
      const adminFee = Math.floor(Math.random() * 150) + 201;
      const totalRp = estimateRobux(robuxVal) + adminFee;
      const gamepassVal = calculateGamepass(robuxVal);

      rUsernameEl.textContent = userName;
      rUserIdEl.textContent = userId;
      rRobuxEl.textContent = robuxVal + " Robux";
      rGamepassEl.textContent = gamepassVal + " Robux";
      rAdminEl.textContent = "Rp" + adminFee.toLocaleString();
      totalAmountEl.textContent = "Rp" + totalRp.toLocaleString();
      amountQREl.textContent = "Total: Rp" + totalRp.toLocaleString();

      // Generate QRIS ‚Äî Contoh format
      qrcodeContainerEl.innerHTML = "";
      new QRCode(qrcodeContainerEl, { text: `TOPUP|${userName}|${robuxVal}|Rp${totalRp}`, width: 240, height: 240 });

      formPageEl.classList.add("hidden");
      resultPageEl.classList.remove("hidden");

      downloadQREl.onclick = () => {
        const canvas = qrcodeContainerEl.querySelector("canvas");
        const link = document.createElement("a");
        link.download = `QRIS_Roblox_${userName}_${robuxVal}Robux.png`;
        link.href = canvas.toDataURL();
        link.click();
      };

      waBtnEl.onclick = () => {
        const msg = `Halo MaltoStore,%0AüéÆ Roblox%0Aüßç Username: ${userName}%0AüÜî UserID: ${userId}%0Aüíé Jumlah: ${robuxVal} Robux%0AüéØ Harga Gamepass: ${gamepassVal} Robux%0Aüí∞ Total: Rp${totalRp.toLocaleString()}%0Aüì± Pembayaran via QRIS`;
        window.open(`https://wa.me/6287832947305?text=${msg}`, "_blank");
      };
    };

    backBtnEl.onclick = () => {
      resultPageEl.classList.add("hidden");
      formPageEl.classList.remove("hidden");
    };
  </script>
</body>
</html>
